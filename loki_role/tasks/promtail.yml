---

    - name: Install prerequisite packages
      package:
        name:
          - unzip
        state: present
      when: ansible_facts['os_family'] in ['Debian', 'RedHat']

    - name: Download Promtail binary
      ansible.builtin.get_url:
        url: https://github.com/grafana/loki/releases/download/v{{ promtail_version }}/promtail-linux-amd64.zip
        dest: /tmp/promtail-linux-amd64.zip

    - name: Unzip Promtail binary
      ansible.builtin.unarchive:
        src: /tmp/promtail-linux-amd64.zip
        dest: /usr/local/bin/
        remote_src: yes

    - name: Move Promtail binary to /usr/local/bin
      ansible.builtin.command:
        cmd: mv /usr/local/bin/promtail-linux-amd64 /usr/local/bin/promtail

    - name: Create Promtail configuration file
      ansible.builtin.copy:
        src: files/promtail-config.yml
        dest: /etc/promtail-local-config.yaml
        
    - name: Create Promtail service file
      ansible.builtin.copy:
        src: files/promtail-service
        dest: /etc/systemd/system/promtail.service
      notify: start promtail


    - name: Reload systemd daemon
      ansible.builtin.systemd:
        daemon_reload: yes
      notify: start promtail

   

    - name: Check Promtail service status
      ansible.builtin.command:
        cmd: systemctl status promtail.service
      register: promtail_status
      changed_when: false

    - name: Print Promtail service status
      ansible.builtin.debug:
        msg: "{{ promtail_status.stdout }}"
